<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAC Assistant Dashboard</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; }
        .user-info { display: flex; align-items: center; gap: 1rem; }
        .sidebar { position: fixed; left: 0; top: 60px; width: 250px; height: calc(100vh - 60px); background: #34495e; color: white; padding: 1rem; }
        .main-content { margin-left: 250px; padding: 2rem; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .widget { background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .widget h3 { margin-bottom: 1rem; color: #2c3e50; }
        .metric { display: flex; justify-content: space-between; margin: 0.5rem 0; }
        .metric-value { font-weight: bold; color: #27ae60; }
        .command-input { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 1rem; }
        .execute-btn { background: #3498db; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; }
        .execute-btn:hover { background: #2980b9; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-online { background: #27ae60; }
        .status-offline { background: #e74c3c; }
        .nav-item { padding: 0.75rem; margin: 0.25rem 0; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: #3498db; }
        #output { background: #2c3e50; color: #ecf0f1; padding: 1rem; border-radius: 5px; height: 200px; overflow-y: auto; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">ü§ñ MAC Assistant Dashboard</div>
        <div class="user-info">
            <span class="status-indicator status-online"></span>
            <span>Connected</span>
            <span>{{ user.username }}</span>
        </div>
    </div>
    
    <div class="sidebar">
        <div class="nav-item active" onclick="showSection('overview')">üìä Overview</div>
        <div class="nav-item" onclick="showSection('commands')">‚ö° Commands</div>
        <div class="nav-item" onclick="showSection('analytics')">üìà Analytics</div>
        <div class="nav-item" onclick="showSection('monitoring')">üëÅÔ∏è Monitoring</div>
        <div class="nav-item" onclick="showSection('settings')">‚öôÔ∏è Settings</div>
    </div>
    
    <div class="main-content">
        <div id="overview-section" class="dashboard-grid">
            <div class="widget">
                <h3>üéØ System Status</h3>
                <div class="metric">
                    <span>MAC Assistant</span>
                    <span class="metric-value">Online</span>
                </div>
                <div class="metric">
                    <span>AI Services</span>
                    <span class="metric-value">Active</span>
                </div>
                <div class="metric">
                    <span>Personalization</span>
                    <span class="metric-value">Learning</span>
                </div>
                <div class="metric">
                    <span>Automation</span>
                    <span class="metric-value">Running</span>
                </div>
            </div>
            
            <div class="widget">
                <h3>üìä Today's Metrics</h3>
                <div class="metric">
                    <span>Commands Processed</span>
                    <span class="metric-value" id="commands-count">0</span>
                </div>
                <div class="metric">
                    <span>Success Rate</span>
                    <span class="metric-value" id="success-rate">0%</span>
                </div>
                <div class="metric">
                    <span>Avg Response Time</span>
                    <span class="metric-value" id="response-time">0ms</span>
                </div>
                <div class="metric">
                    <span>Active Features</span>
                    <span class="metric-value" id="active-features">8</span>
                </div>
            </div>
            
            <div class="widget">
                <h3>‚ö° Quick Commands</h3>
                <input type="text" class="command-input" id="quickCommand" placeholder="Enter MAC command...">
                <button class="execute-btn" onclick="executeCommand()">Execute</button>
                <div id="output"></div>
            </div>
            
            <div class="widget">
                <h3>üîÑ Recent Activity</h3>
                <div id="recent-activity">
                    <div style="color: #7f8c8d; text-align: center; padding: 2rem;">
                        No recent activity
                    </div>
                </div>
            </div>
        </div>
        
        <div id="commands-section" style="display: none;">
            <div class="widget">
                <h3>‚ö° Command Center</h3>
                <p>Execute MAC commands remotely with full access to all features.</p>
                <input type="text" class="command-input" id="commandInput" placeholder="Enter command (e.g., 'what time is it', 'search for AI news')">
                <button class="execute-btn" onclick="executeDetailedCommand()">Execute Command</button>
                <div id="commandOutput" style="margin-top: 1rem;"></div>
            </div>
        </div>
        
        <div id="analytics-section" style="display: none;">
            <div class="widget">
                <h3>üìà Usage Analytics</h3>
                <canvas id="usageChart" width="400" height="200"></canvas>
            </div>
        </div>
        
        <div id="monitoring-section" style="display: none;">
            <div class="widget">
                <h3>üëÅÔ∏è Real-time Monitoring</h3>
                <p>Monitor MAC Assistant performance and activities in real-time.</p>
                <div id="monitoring-data"></div>
            </div>
        </div>
        
        <div id="settings-section" style="display: none;">
            <div class="widget">
                <h3>‚öôÔ∏è Dashboard Settings</h3>
                <p>Customize your dashboard experience and preferences.</p>
            </div>
        </div>
    </div>
    
    <script>
        const socket = io();
        
        socket.on('connect', function() {
            console.log('Connected to MAC Dashboard');
            updateStatus('Connected', true);
        });
        
        socket.on('disconnect', function() {
            console.log('Disconnected from MAC Dashboard');
            updateStatus('Disconnected', false);
        });
        
        socket.on('command_result', function(data) {
            displayCommandResult(data);
        });
        
        socket.on('metrics_update', function(data) {
            updateMetrics(data.metrics);
        });
        
        function updateStatus(status, online) {
            const indicator = document.querySelector('.status-indicator');
            const statusText = document.querySelector('.user-info span:nth-child(2)');
            indicator.className = `status-indicator ${online ? 'status-online' : 'status-offline'}`;
            statusText.textContent = status;
        }
        
        function executeCommand() {
            const command = document.getElementById('quickCommand').value;
            if (command.trim()) {
                socket.emit('execute_command', { command: command });
                document.getElementById('quickCommand').value = '';
                addToOutput(`> ${command}`);
            }
        }
        
        function executeDetailedCommand() {
            const command = document.getElementById('commandInput').value;
            if (command.trim()) {
                socket.emit('execute_command', { command: command });
                document.getElementById('commandInput').value = '';
            }
        }
        
        function displayCommandResult(result) {
            addToOutput(`${result.message}`);
            
            // Also update detailed command output if visible
            const detailedOutput = document.getElementById('commandOutput');
            if (detailedOutput) {
                detailedOutput.innerHTML = `
                    <div style="background: #ecf0f1; padding: 1rem; border-radius: 5px; margin-top: 1rem;">
                        <strong>Status:</strong> ${result.status}<br>
                        <strong>Response:</strong> ${result.message}
                    </div>
                `;
            }
        }
        
        function addToOutput(text) {
            const output = document.getElementById('output');
            output.textContent += text + '\n';
            output.scrollTop = output.scrollHeight;
        }
        
        function updateMetrics(metrics) {
            // Update dashboard metrics
            document.getElementById('commands-count').textContent = metrics.commands_processed || 0;
            document.getElementById('success-rate').textContent = (metrics.success_rate || 0) + '%';
            document.getElementById('response-time').textContent = (metrics.avg_response_time || 0) + 'ms';
        }
        
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').style.display = 'block';
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // Request initial metrics
        socket.emit('request_metrics');
        
        // Auto-refresh metrics every 30 seconds
        setInterval(() => {
            socket.emit('request_metrics');
        }, 30000);
        
        // Enter key support for commands
        document.getElementById('quickCommand').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                executeCommand();
            }
        });
        
        document.getElementById('commandInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                executeDetailedCommand();
            }
        });
    </script>
</body>
</html>